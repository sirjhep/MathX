tinymce.PluginManager.add('MathX',function(editor,url){var $=editor.$;var MathX={isActive:false,jaxSrc:'https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=',jaxConfig:'AM_HTMLorMML-full',init:function(jaxFrame){this.isActive=true;var W=editor.getWin();var jax=(jaxFrame.id)?W.MathJax.Hub.getJaxFor(jaxFrame.id):false;this.currentMXE=new this.editor(jaxFrame,jax);},insert:function(){var content=editor.selection.getContent();editor.insertContent('<span class="MathJax">');MathX.currentMXE.input.value=content;},editor:function(jaxFrame,jax){this.isNew=(jax)?false:true;this.jax=(this.isNew)?false:jax;this.frame=jaxFrame;var cMXE=this;var W=editor.getWin();var doc=editor.getDoc();this.init=function(){this.table=doc.createElement('table');this.row1=this.table.insertRow(0);this.cell11=this.row1.insertCell(0);this.row2=this.table.insertRow(1);this.cell21=this.row2.insertCell(0);this.input=doc.createElement('input');this.table.id="MXE";this.cell21.title="Preview";if(this.isNew){this.input.placeholder="Insert expression here...";this.input.value="";}else
this.input.value=this.jax.originalText;this.input.id="MathXE-Input";this.input.type='text';this.cell21.id='MathXE-Preview';this.input.oninput=function(e){cMXE.showPreview();};this.input.onblur=function(e){cMXE.close();};this.cell11.appendChild(this.input);$(this.frame).hide().before(this.table);this.showPreview();this.input.focus();};this.showPreview=function(){this.cell21.innerHTML='`'+this.input.value+'`';W.MathJax.Hub.Typeset('MathXE-Preview');};this.close=function(){if(this.isNew){if(this.input.value===''){this.frame.remove();this.table.remove();}else{var txtnode=W.document.createTextNode('`'+this.input.value+'`');this.frame.parentNode.replaceChild(txtnode,this.table);this.frame.remove();W.MathJax.Hub.Queue(function(){W.MathJax.Hub.Typeset();});}}else{W.MathJax.Hub.Queue(function(){cMXE.jax.Text(cMXE.input.value);});this.table.remove();$(this.frame).show();}
MathX.isActive=false;MathX.currentMXE=false;editor.selection.moveToBookmark(MathX.endBM);};this.esc=function(){this.table.remove();$(this.frame).show();MathX.isActive=false;MathX.currentMXE=false;editor.selection.moveToBookmark(MathX.endBM);};this.init();}};(function(){var S=document.querySelectorAll('script[src]');var F=S[S.length-1].src;var Fs=F.split('/');MathX.path=Fs[Fs.length-2];})();editor.on('init',function(ed){var script=this.getDoc().createElement("script");script.type="text/javascript";script.src='https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=AM_HTMLorMML-full';this.getDoc().getElementsByTagName("head")[0].appendChild(script);script.onload=function(){editor.getWin().MathJax.Hub.Queue(function(){editor.getWin().MathJax.Hub.Config({showProcessingMessages:false});});};editor.dom.loadCSS(MathX.path+'/style.css');});editor.on('NodeChange',function(e){var P=e.parents;for(var i in P)
if(P[i].classList.contains('MathJax')&&!MathX.isActive){MXE=MathX.init(P[i]);}});editor.on('keydown',function(e){if(e.target.id=='MathXE-Input'&&(e.keyCode==13||e.which==13)&&MathX.isActive){e.preventDefault();MathX.currentMXE.close();}else if(e.target.id=='MathXE-Input'&&(e.keyCode==27||e.which==27)&&MathX.isActive)
MathX.currentMXE.esc();else if(e.target.id=='MathXE-Input'&&(e.keyCode==8||e.which==8)&&MathX.isActive)
MathX.currentMXE.input.value=MathX.currentMXE.input.value.substr(0,MathX.currentMXE.input.value.length-1);});editor.on('keyup',function(e){if(e.keyCode==61&&e.altKey)
MathX.insert();});editor.addButton('MathX',{text:'f(x)',icon:false,onclick:function(e){MathX.insert();}});editor.addMenuItem('MathX',{text:'MathX Help',context:'tools',onclick:function(){editor.windowManager.open({title:'ASCII Syntax Guide',url:'http://asciimath.org/',width:800,height:400,buttons:[{text:'Close',onclick:'close'}]});}});});